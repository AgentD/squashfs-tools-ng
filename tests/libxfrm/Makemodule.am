LIBXFRM_LIBS = $(ZLIB_LIBS) $(XZ_LIBS) $(BZIP2_LIBS) $(ZSTD_LIBS)
LIBXFRM_TESTS =

if WITH_GZIP
test_unpack_gzip_SOURCES = tests/libxfrm/unpack.c
test_unpack_gzip_LDADD = libxfrm.a $(ZLIB_LIBS)
test_unpack_gzip_CPPFLAGS = $(AM_CPPFLAGS) -DDO_GZIP=1

test_pack_gzip_SOURCES = tests/libxfrm/pack.c
test_pack_gzip_LDADD = libxfrm.a $(LIBXFRM_LIBS)
test_pack_gzip_CPPFLAGS = $(AM_CPPFLAGS) -DDO_GZIP=1

LIBXFRM_TESTS += test_pack_gzip test_unpack_gzip
endif

if WITH_XZ
test_unpack_xz_SOURCES = tests/libxfrm/unpack.c
test_unpack_xz_LDADD = libxfrm.a $(XZ_LIBS)
test_unpack_xz_CPPFLAGS = $(AM_CPPFLAGS) -DDO_XZ=1

test_pack_xz_SOURCES = tests/libxfrm/pack.c
test_pack_xz_LDADD = libxfrm.a $(LIBXFRM_LIBS)
test_pack_xz_CPPFLAGS = $(AM_CPPFLAGS) -DDO_XZ=1

LIBXFRM_TESTS += test_pack_xz test_unpack_xz
endif

if WITH_BZIP2
test_unpack_bzip2_SOURCES = tests/libxfrm/unpack.c
test_unpack_bzip2_LDADD = libxfrm.a $(BZIP2_LIBS)
test_unpack_bzip2_CPPFLAGS = $(AM_CPPFLAGS) -DDO_BZIP2=1

test_pack_bzip2_SOURCES = tests/libxfrm/pack.c
test_pack_bzip2_LDADD = libxfrm.a $(LIBXFRM_LIBS)
test_pack_bzip2_CPPFLAGS = $(AM_CPPFLAGS) -DDO_BZIP2=1

LIBXFRM_TESTS += test_unpack_bzip2 test_pack_bzip2
endif

if WITH_ZSTD
if HAVE_ZSTD_STREAM
test_pack_zstd_SOURCES = tests/libxfrm/unpack.c
test_pack_zstd_LDADD = libxfrm.a $(ZSTD_LIBS)
test_pack_zstd_CPPFLAGS = $(AM_CPPFLAGS) -DDO_ZSTD=1

test_unpack_zstd_SOURCES = tests/libxfrm/pack.c
test_unpack_zstd_LDADD = libxfrm.a $(LIBXFRM_LIBS)
test_unpack_zstd_CPPFLAGS = $(AM_CPPFLAGS) -DDO_ZSTD=1

LIBXFRM_TESTS += test_pack_zstd test_unpack_zstd
endif
endif

check_PROGRAMS += $(LIBXFRM_TESTS)
TESTS += $(LIBXFRM_TESTS)
