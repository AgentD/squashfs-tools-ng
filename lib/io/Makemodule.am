libio_a_SOURCES = include/io/istream.h include/io/ostream.h include/io/xfrm.h \
	include/io/file.h include/io/std.h \
	lib/io/src/internal.h lib/io/src/ostream.c \
	lib/io/src/istream.c lib/io/src/get_line.c lib/io/src/xfrm/ostream.c \
	lib/io/src/xfrm/istream.c
libio_a_CFLAGS = $(AM_CFLAGS) $(ZLIB_CFLAGS) $(XZ_CFLAGS)
libio_a_CFLAGS += $(ZSTD_CFLAGS) $(BZIP2_CFLAGS)

if WINDOWS
libio_a_SOURCES += lib/io/src/win32/ostream.c lib/io/src/win32/istream.c
libio_a_CFLAGS += -DWINVER=0x0600 -D_WIN32_WINNT=0x0600
else
libio_a_SOURCES += lib/io/src/unix/ostream.c lib/io/src/unix/istream.c
endif

noinst_LIBRARIES += libio.a

test_get_line_SOURCES = lib/io/test/get_line.c
test_get_line_LDADD = libio.a libcompat.a
test_get_line_CPPFLAGS = $(AM_CPPFLAGS)
test_get_line_CPPFLAGS += -DTESTFILE=$(top_srcdir)/lib/io/test/get_line.txt

test_sparse_fb_SOURCES = lib/io/test/sparse_fb.c
test_sparse_fb_LDADD = libio.a libutil.a libcompat.a

test_istream_read_SOURCES = lib/io/test/istream_read.c
test_istream_read_LDADD = libio.a libutil.a libcompat.a

test_istream_skip_SOURCES = lib/io/test/istream_skip.c
test_istream_skip_LDADD = libio.a libutil.a libcompat.a

test_stream_splice_SOURCES = lib/io/test/stream_splice.c
test_stream_splice_LDADD = libio.a libutil.a libcompat.a

check_PROGRAMS += test_get_line test_sparse_fb test_istream_read
check_PROGRAMS += test_istream_skip test_stream_splice
TESTS += test_get_line test_sparse_fb test_istream_read
TESTS += test_istream_skip test_stream_splice

EXTRA_DIST += $(top_srcdir)/lib/io/test/get_line.txt
